<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cqut.czb.bn.dao.mapper.weChatSmallProgram.WeChatCommodityMapperExtra" >
    <resultMap id="BaseResultMap" type="com.cqut.czb.bn.entity.dto.wechatAppletCommodity.WxCommodityDTO" >
        <id column="commodity_id" property="commodityId" jdbcType="VARCHAR" />
        <result column="shop_id" property="shopId" jdbcType="VARCHAR" />
        <result column="commodity_title" property="commodityTitle" jdbcType="VARCHAR" />
        <result column="commodity_info" property="commodityInfo" jdbcType="VARCHAR" />
        <result column="discount" property="discount" jdbcType="DOUBLE" />
        <result column="commodity_img_id" property="commodityImgId" jdbcType="VARCHAR" />
        <result column="cost_price" property="costPrice" jdbcType="DOUBLE" />
        <result column="original_price" property="originalPrice" jdbcType="DOUBLE" />
        <result column="sale_price" property="salePrice" jdbcType="DOUBLE" />
        <result column="commmodity_type_id" property="commmodityTypeId" jdbcType="VARCHAR" />
        <result column="starting_time_business" property="startingTimeBusiness" jdbcType="TIMESTAMP" />
        <result column="end_time_business" property="endTimeBusiness" jdbcType="TIMESTAMP" />
        <result column="commodity_source" property="commoditySource" jdbcType="VARCHAR" />
        <result column="commodity_num" property="commodityNum" jdbcType="INTEGER" />
        <result column="is_sale" property="isSale" jdbcType="INTEGER" />
        <result column="take_way" property="takeWay" jdbcType="INTEGER" />
        <result column="shop_name" property="shopName" jdbcType="VARCHAR" />
        <result column="shop_phone" property="shopPhone" jdbcType="VARCHAR" />
        <result column="shop_content" property="shopContent" jdbcType="VARCHAR" />
        <result column="shop_address" property="shopAddress" jdbcType="VARCHAR" />
        <result column="longitude" property="longitude" jdbcType="DOUBLE" />
        <result column="latitude" property="latitude" jdbcType="DOUBLE" />
        <result column="is_have_shop" property="isHaveShop" jdbcType="INTEGER" />
        <result column="show_place" property="showPlace" jdbcType="VARCHAR" />
        <result column="show_order" property="showOrder" jdbcType="INTEGER" />
        <result column="create_at" property="createAt" jdbcType="TIMESTAMP" />
        <result column="update_at" property="updateAt" jdbcType="TIMESTAMP" />
        <result column="fyMoney" property="fyMoney" jdbcType="VARCHAR" />
        <collection property="imgs" select="selectImgs" column="commodity_img_id"></collection>
        <collection property="posterImg" select="selectPosterImg" column="commodity_img_id"></collection>
    </resultMap>

    <resultMap id="BaseAttributeMap" type="com.cqut.czb.bn.entity.dto.wechatAppletCommodity.WxAttributeDTO" >
        <id column="commodity_attr_id" property="commmodityAttrId" jdbcType="VARCHAR" />
        <result column="extra_fy_money" property="extraFyMoney" jdbcType="DOUBLE" />
        <result column="commodity_id" property="commodityId" jdbcType="VARCHAR" />
        <result column="attribute_id" property="attributeId" jdbcType="VARCHAR" />
        <result column="extra_sale_money" property="extraSaleMoney" jdbcType="DOUBLE" />
        <result column="file_id" property="fileId" jdbcType="VARCHAR" />
        <result column="attr_order" property="attrOrder" jdbcType="INTEGER" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="content" property="content" jdbcType="VARCHAR" />
        <collection property="imgs" select="selectAllImgs" column="file_id"></collection>
    </resultMap>
    <sql id="Base_Column_List" >
        commodity_id, shop_id, commodity_title, commodity_info, discount, commodity_img_id,
        cost_price, original_price, sale_price, commmodity_type_id, starting_time_business,
        end_time_business, commodity_source, commodity_num, is_sale, take_way, shop_name,
        shop_phone, shop_content, shop_address, longitude, latitude, is_have_shop, show_place,
        show_order, create_at, update_at
    </sql>
    <resultMap id="functionImgsMap" type="com.cqut.czb.bn.entity.dto.shop.FileFunctionDTO">
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="group_code" property="groupCode" jdbcType="VARCHAR" />
        <result column="file_id" property="fileId" jdbcType="VARCHAR" />
        <result column="local_id" property="localId" jdbcType="VARCHAR" />
        <result column="save_path" property="src" jdbcType="VARCHAR" />
        <result column="create_at" property="createAt" jdbcType="TIMESTAMP" />
        <result column="update_at" property="updateAt" jdbcType="TIMESTAMP" />
    </resultMap>
    <select id="selectImgs" resultMap="functionImgsMap" >
        SELECT
            cff.local_id,
            cff.file_id,
            cff.group_code,
            cf.save_path
        FROM
            czb_file_function cff
	    LEFT JOIN czb_file cf ON cff.file_id = cf.file_id
        WHERE cff.local_id = #{commodity_img_id,jdbcType=VARCHAR}
        AND group_code = 'WCCommodity'
    </select>

    <select id="selectAllImgs" resultMap="functionImgsMap" >
        SELECT
            czb_file_function.id,
            czb_file_function.group_code,
            czb_file_function.file_id,
            czb_file_function.local_id,
            czb_file.save_path,
            czb_file_function.create_at,
            czb_file_function.update_at
        FROM
            czb_file,
            czb_file_function
        WHERE
            czb_file_function.local_id = #{file_id, jdbcType=VARCHAR}
            and czb_file_function.file_id = czb_file.file_id
    </select>

    <select id="selectPosterImg" resultMap="functionImgsMap" >
        SELECT
            cff.local_id,
            cff.file_id,
            cff.group_code,
            cf.save_path
        FROM
            czb_file_function cff
	    LEFT JOIN czb_file cf ON cff.file_id = cf.file_id
        WHERE cff.local_id = #{commodity_img_id,jdbcType=VARCHAR}
        AND group_code = 'PosterImg'
    </select>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
        select
        <include refid="Base_Column_List" />
        from czb_wechat_commodity
        where commodity_id = #{commodityId,jdbcType=VARCHAR}
    </select>
    <select id="selectAllCommodity" resultMap="BaseResultMap" parameterType="java.lang.String" >
        select
        commodity_id, czb_shop.shop_id, commodity_title, commodity_info, discount, commodity_img_id,
        cost_price, original_price, sale_price, commmodity_type_id, czb_wechat_commodity.starting_time_business,
        czb_wechat_commodity.end_time_business, commodity_source, commodity_num, is_sale, take_way, czb_shop.shop_name,
        czb_wechat_commodity.shop_phone, czb_wechat_commodity.shop_content, czb_wechat_commodity.shop_address, czb_wechat_commodity.longitude, czb_wechat_commodity.latitude, is_have_shop, show_place,
        show_order, czb_wechat_commodity.create_at, czb_wechat_commodity.update_at, czb_wechat_commodity.fy_money fyMoney, czb_wechat_commodity.commodity_introduce commodityIntroduce, area,sales_volume salesVolume
        from czb_wechat_commodity
        LEFT JOIN czb_shop ON czb_wechat_commodity.shop_id = czb_shop.shop_id
        <where>
          <if test="commodityTitle != null and commodityTitle !=''">
              AND commodity_title LIKE concat('%',#{commodityTitle,jdbcType=VARCHAR},'%')
          </if>
            <if test="showPlace != null and showPlace !=''">
                AND show_place = #{showPlace,jdbcType=VARCHAR}
            </if>
            <if test="isSale != null ">
                AND is_sale = #{isSale,jdbcType=INTEGER}
            </if>
            <if test="commoditySource != null and commoditySource !=''">
                AND commodity_source LIKE concat('%',#{commoditySource,jdbcType=VARCHAR},'%')
            </if>
            <if test="takeWay != null and takeWay !=''">
                AND take_way LIKE concat('%',#{takeWay,jdbcType=VARCHAR},'%')
            </if>
            <if test="userId != null and userId !=''">
                AND czb_shop.user_id = #{userId,jdbcType=INTEGER}
            </if>
        </where>
    </select>
<!-- 查询商品属性信息-->
    <select id="selectAllWxAttribute" parameterType="com.cqut.czb.bn.entity.dto.wechatAppletCommodity.WxAttributeDTO" resultMap="BaseAttributeMap">
            SELECT
                czb_wechat_commodity_attr.commodity_attr_id,
                czb_wechat_commodity_attr.extra_fy_money,
                czb_wechat_commodity_attr.commodity_id,
                czb_wechat_commodity_attr.attribute_id,
                czb_wechat_commodity_attr.extra_sale_money,
                czb_wechat_commodity_attr.file_id,
                czb_wechat_commodity_attr.attr_order,
                czb_attribute.`name`,
                czb_attribute.content
            FROM
                czb_wechat_commodity_attr,
                czb_attribute
            WHERE
                commodity_id = #{commodityId}
                AND czb_wechat_commodity_attr.attribute_id = czb_attribute.attribute_id
            ORDER BY czb_wechat_commodity_attr.create_at DESC;
    </select>

    <delete id="deleteWxAttribute" parameterType="java.lang.String">
        delete from czb_wechat_commodity_attr
        where commodity_attr_id = #{commmodityAttrId}
    </delete>

    <!--获取提供服务的地区列表-->
    <select id="getAreas" resultType="java.lang.String">
--         select content
--         from czb_dict
--         where name='bussiness_area'
        SELECT
            area
        FROM
            czb_wechat_commodity
        WHERE
            area IS NOT NULL
        AND area != ''
        AND area != 'null'
        GROUP BY
            area
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
        delete from czb_wechat_commodity
        where commodity_id = #{commodityId,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.cqut.czb.bn.entity.entity.weChatSmallProgram.WeChatCommodity" >
        insert into czb_wechat_commodity (commodity_id, shop_id, commodity_title,
        commodity_info, discount, commodity_img_id,
        cost_price, original_price, sale_price,
        commmodity_type_id, starting_time_business,
        end_time_business, commodity_source, commodity_num,
        is_sale, take_way, shop_name,
        shop_phone, shop_content, shop_address,
        longitude, latitude, is_have_shop,
        show_place, show_order, create_at,
        update_at)
        values (#{commodityId,jdbcType=VARCHAR}, #{shopId,jdbcType=VARCHAR}, #{commodityTitle,jdbcType=VARCHAR},
        #{commodityInfo,jdbcType=VARCHAR}, #{discount,jdbcType=DOUBLE}, #{commodityImgId,jdbcType=VARCHAR},
        #{costPrice,jdbcType=DOUBLE}, #{originalPrice,jdbcType=DOUBLE}, #{salePrice,jdbcType=DOUBLE},
        #{commmodityTypeId,jdbcType=VARCHAR}, #{startingTimeBusiness,jdbcType=TIMESTAMP},
        #{endTimeBusiness,jdbcType=TIMESTAMP}, #{commoditySource,jdbcType=VARCHAR}, #{commodityNum,jdbcType=INTEGER},
        #{isSale,jdbcType=INTEGER}, #{takeWay,jdbcType=INTEGER}, #{shopName,jdbcType=VARCHAR},
        #{shopPhone,jdbcType=VARCHAR}, #{shopContent,jdbcType=VARCHAR}, #{shopAddress,jdbcType=VARCHAR},
        #{longitude,jdbcType=DOUBLE}, #{latitude,jdbcType=DOUBLE}, #{isHaveShop,jdbcType=INTEGER},
        #{showPlace,jdbcType=VARCHAR}, #{showOrder,jdbcType=INTEGER}, #{createAt,jdbcType=TIMESTAMP},
        #{updateAt,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertSelective" parameterType="com.cqut.czb.bn.entity.entity.weChatSmallProgram.WeChatCommodity" >
        insert into czb_wechat_commodity
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="commodityId != null" >
                commodity_id,
            </if>
            <if test="shopId != null" >
                shop_id,
            </if>
            <if test="commodityTitle != null" >
                commodity_title,
            </if>
            <if test="commodityInfo != null" >
                commodity_info,
            </if>
            <if test="discount != null" >
                discount,
            </if>
            <if test="commodityImgId != null" >
                commodity_img_id,
            </if>
            <if test="costPrice != null" >
                cost_price,
            </if>
            <if test="originalPrice != null" >
                original_price,
            </if>
            <if test="salePrice != null" >
                sale_price,
            </if>
            <if test="commmodityTypeId != null" >
                commmodity_type_id,
            </if>
            <if test="startingTimeBusiness != null" >
                starting_time_business,
            </if>
            <if test="endTimeBusiness != null" >
                end_time_business,
            </if>
            <if test="commoditySource != null" >
                commodity_source,
            </if>
            <if test="commodityNum != null" >
                commodity_num,
            </if>
            <if test="isSale != null" >
                is_sale,
            </if>
            <if test="takeWay != null" >
                take_way,
            </if>
            <if test="shopName != null" >
                shop_name,
            </if>
            <if test="shopPhone != null" >
                shop_phone,
            </if>
            <if test="shopContent != null" >
                shop_content,
            </if>
            <if test="shopAddress != null" >
                shop_address,
            </if>
            <if test="longitude != null" >
                longitude,
            </if>
            <if test="latitude != null" >
                latitude,
            </if>
            <if test="isHaveShop != null" >
                is_have_shop,
            </if>
            <if test="showPlace != null" >
                show_place,
            </if>
            <if test="showOrder != null" >
                show_order,
            </if>
            <if test="createAt != null" >
                create_at,
            </if>
            <if test="updateAt != null" >
                update_at,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="commodityId != null" >
                #{commodityId,jdbcType=VARCHAR},
            </if>
            <if test="shopId != null" >
                #{shopId,jdbcType=VARCHAR},
            </if>
            <if test="commodityTitle != null" >
                #{commodityTitle,jdbcType=VARCHAR},
            </if>
            <if test="commodityInfo != null" >
                #{commodityInfo,jdbcType=VARCHAR},
            </if>
            <if test="discount != null" >
                #{discount,jdbcType=DOUBLE},
            </if>
            <if test="commodityImgId != null" >
                #{commodityImgId,jdbcType=VARCHAR},
            </if>
            <if test="costPrice != null" >
                #{costPrice,jdbcType=DOUBLE},
            </if>
            <if test="originalPrice != null" >
                #{originalPrice,jdbcType=DOUBLE},
            </if>
            <if test="salePrice != null" >
                #{salePrice,jdbcType=DOUBLE},
            </if>
            <if test="commmodityTypeId != null" >
                #{commmodityTypeId,jdbcType=VARCHAR},
            </if>
            <if test="startingTimeBusiness != null" >
                #{startingTimeBusiness,jdbcType=TIMESTAMP},
            </if>
            <if test="endTimeBusiness != null" >
                #{endTimeBusiness,jdbcType=TIMESTAMP},
            </if>
            <if test="commoditySource != null" >
                #{commoditySource,jdbcType=VARCHAR},
            </if>
            <if test="commodityNum != null" >
                #{commodityNum,jdbcType=INTEGER},
            </if>
            <if test="isSale != null" >
                #{isSale,jdbcType=INTEGER},
            </if>
            <if test="takeWay != null" >
                #{takeWay,jdbcType=INTEGER},
            </if>
            <if test="shopName != null" >
                #{shopName,jdbcType=VARCHAR},
            </if>
            <if test="shopPhone != null" >
                #{shopPhone,jdbcType=VARCHAR},
            </if>
            <if test="shopContent != null" >
                #{shopContent,jdbcType=VARCHAR},
            </if>
            <if test="shopAddress != null" >
                #{shopAddress,jdbcType=VARCHAR},
            </if>
            <if test="longitude != null" >
                #{longitude,jdbcType=DOUBLE},
            </if>
            <if test="latitude != null" >
                #{latitude,jdbcType=DOUBLE},
            </if>
            <if test="isHaveShop != null" >
                #{isHaveShop,jdbcType=INTEGER},
            </if>
            <if test="showPlace != null" >
                #{showPlace,jdbcType=VARCHAR},
            </if>
            <if test="showOrder != null" >
                #{showOrder,jdbcType=INTEGER},
            </if>
            <if test="createAt != null" >
                #{createAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updateAt != null" >
                #{updateAt,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.cqut.czb.bn.entity.entity.weChatSmallProgram.WeChatCommodity" >
        update czb_wechat_commodity
        <set >
            <if test="shopId != null" >
                shop_id = #{shopId,jdbcType=VARCHAR},
            </if>
            <if test="commodityTitle != null" >
                commodity_title = #{commodityTitle,jdbcType=VARCHAR},
            </if>
            <if test="commodityInfo != null" >
                commodity_info = #{commodityInfo,jdbcType=VARCHAR},
            </if>
            <if test="discount != null" >
                discount = #{discount,jdbcType=DOUBLE},
            </if>
            <if test="commodityImgId != null" >
                commodity_img_id = #{commodityImgId,jdbcType=VARCHAR},
            </if>
            <if test="costPrice != null" >
                cost_price = #{costPrice,jdbcType=DOUBLE},
            </if>
            <if test="originalPrice != null" >
                original_price = #{originalPrice,jdbcType=DOUBLE},
            </if>
            <if test="salePrice != null" >
                sale_price = #{salePrice,jdbcType=DOUBLE},
            </if>
            <if test="commmodityTypeId != null" >
                commmodity_type_id = #{commmodityTypeId,jdbcType=VARCHAR},
            </if>
            <if test="startingTimeBusiness != null" >
                starting_time_business = #{startingTimeBusiness,jdbcType=TIMESTAMP},
            </if>
            <if test="endTimeBusiness != null" >
                end_time_business = #{endTimeBusiness,jdbcType=TIMESTAMP},
            </if>
            <if test="commoditySource != null" >
                commodity_source = #{commoditySource,jdbcType=VARCHAR},
            </if>
            <if test="commodityNum != null" >
                commodity_num = #{commodityNum,jdbcType=INTEGER},
            </if>
            <if test="isSale != null" >
                is_sale = #{isSale,jdbcType=INTEGER},
            </if>
            <if test="takeWay != null" >
                take_way = #{takeWay,jdbcType=INTEGER},
            </if>
            <if test="shopName != null" >
                shop_name = #{shopName,jdbcType=VARCHAR},
            </if>
            <if test="shopPhone != null" >
                shop_phone = #{shopPhone,jdbcType=VARCHAR},
            </if>
            <if test="shopContent != null" >
                shop_content = #{shopContent,jdbcType=VARCHAR},
            </if>
            <if test="shopAddress != null" >
                shop_address = #{shopAddress,jdbcType=VARCHAR},
            </if>
            <if test="longitude != null" >
                longitude = #{longitude,jdbcType=DOUBLE},
            </if>
            <if test="latitude != null" >
                latitude = #{latitude,jdbcType=DOUBLE},
            </if>
            <if test="isHaveShop != null" >
                is_have_shop = #{isHaveShop,jdbcType=INTEGER},
            </if>
            <if test="showPlace != null" >
                show_place = #{showPlace,jdbcType=VARCHAR},
            </if>
            <if test="showOrder != null" >
                show_order = #{showOrder,jdbcType=INTEGER},
            </if>
            <if test="createAt != null" >
                create_at = #{createAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updateAt != null" >
                update_at = #{updateAt,jdbcType=TIMESTAMP},
            </if>
            <if test="fyMoney != null" >
                fy_money = #{fyMoney,jdbcType=VARCHAR},
            </if>
        </set>
        where commodity_id = #{commodityId,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.cqut.czb.bn.entity.entity.weChatSmallProgram.WeChatCommodity" >
        update czb_wechat_commodity
        set shop_id = #{shopId,jdbcType=VARCHAR},
        commodity_title = #{commodityTitle,jdbcType=VARCHAR},
        commodity_info = #{commodityInfo,jdbcType=VARCHAR},
        discount = #{discount,jdbcType=DOUBLE},
        commodity_img_id = #{commodityImgId,jdbcType=VARCHAR},
        cost_price = #{costPrice,jdbcType=DOUBLE},
        original_price = #{originalPrice,jdbcType=DOUBLE},
        sale_price = #{salePrice,jdbcType=DOUBLE},
        commmodity_type_id = #{commmodityTypeId,jdbcType=VARCHAR},
        starting_time_business = #{startingTimeBusiness,jdbcType=TIMESTAMP},
        end_time_business = #{endTimeBusiness,jdbcType=TIMESTAMP},
        commodity_source = #{commoditySource,jdbcType=VARCHAR},
        commodity_num = #{commodityNum,jdbcType=INTEGER},
        is_sale = #{isSale,jdbcType=INTEGER},
        take_way = #{takeWay,jdbcType=INTEGER},
        shop_name = #{shopName,jdbcType=VARCHAR},
        shop_phone = #{shopPhone,jdbcType=VARCHAR},
        shop_content = #{shopContent,jdbcType=VARCHAR},
        shop_address = #{shopAddress,jdbcType=VARCHAR},
        longitude = #{longitude,jdbcType=DOUBLE},
        latitude = #{latitude,jdbcType=DOUBLE},
        is_have_shop = #{isHaveShop,jdbcType=INTEGER},
        show_place = #{showPlace,jdbcType=VARCHAR},
        show_order = #{showOrder,jdbcType=INTEGER},
        create_at = #{createAt,jdbcType=TIMESTAMP},
        update_at = #{updateAt,jdbcType=TIMESTAMP}
        where commodity_id = #{commodityId,jdbcType=VARCHAR}
    </update>

    <resultMap id="WCPCommodityInfoType" type="com.cqut.czb.bn.entity.dto.WeChatCommodity.WCPCommodityOutputDTO" >
        <id column="commodityId" property="commodityId" jdbcType="VARCHAR" />
        <result column="commodityTitle" property="commodityTitle" jdbcType="VARCHAR" />
        <result column="commodityInfo" property="commodityInfo" jdbcType="VARCHAR" />
        <result column="originalPrice" property="originalPrice" jdbcType="VARCHAR" />
        <result column="salePrice" property="salePrice" jdbcType="VARCHAR" />
        <result column="takeWay" property="takeWay" jdbcType="VARCHAR" />
        <result column="shopName" property="shopName" jdbcType="VARCHAR" />
        <result column="shopContent" property="shopContent" jdbcType="VARCHAR" />
        <result column="commodityNum" property="commodityNum" jdbcType="VARCHAR" />
        <result column="shopAddress" property="shopAddress" jdbcType="VARCHAR" />
        <result column="longitude" property="longitude" jdbcType="VARCHAR" />
        <result column="latitude" property="latitude" jdbcType="VARCHAR" />
        <result column="startingTimeBusiness" property="startingTimeBusiness" jdbcType="VARCHAR" />
        <result column="endTimeBusiness" property="endTimeBusiness" jdbcType="VARCHAR" />
        <result column="commodity_img_id" property="commodityImgId" jdbcType="VARCHAR" />
        <result column="totalFyMoney" property="totalFyMoney" jdbcType="VARCHAR" />
        <result column="isHaveShop" property="isHaveShop" jdbcType="INTEGER" />
        <result column="commodityImgId" property="commodityImgId" jdbcType="VARCHAR" />
        <result column="shopPhone" property="shopPhone" jdbcType="VARCHAR" />
        <result column="salesVolume" property="salesVolume" jdbcType="INTEGER" />
        <collection property="commodityImg" column="commodityImgId" javaType="list" select="selectCommodityImgList"/>
        <collection property="posterImg" column="commodityImgId" javaType="String" select="selectCommodityPosterImg"/>
        <collection property="attrs" column="commodityId" javaType="list" select="selectCommodityAttrs"></collection>
    </resultMap>

    <select id="selectAllCommodityByArea" parameterType="com.cqut.czb.bn.entity.dto.WeChatCommodity.WCPCommodityInputDTO" resultMap="WCPCommodityInfoType">
        SELECT
        czb_wechat_commodity.commodity_id commodityId,
        commodity_title commodityTitle,
        commodity_info commodityInfo,
        original_price originalPrice,
        sale_price salePrice,
        take_way takeWay,
        commodity_img_id commodityImgId,
        czb_shop.shop_name shopName,
        czb_shop.shop_content shopContent,
        czb_shop.shop_address shopAddress,
        czb_wechat_commodity.commodity_num commodityNum,
        czb_shop.longitude,
        czb_shop.latitude,
        is_have_shop isHaveShop,
        czb_shop.shop_phone shopPhone,
        czb_wechat_commodity.fy_money totalFyMoney,
        czb_wechat_commodity.starting_time_business startingTimeBusiness,
        czb_wechat_commodity.end_time_business endTimeBusiness,
        czb_wechat_commodity.commodity_introduce commodityIntroduce,
        czb_wechat_commodity.sales_volume salesVolume
        FROM
        czb_wechat_commodity czb_wechat_commodity
        LEFT JOIN czb_wechat_commodity_order ON czb_wechat_commodity.commodity_id = czb_wechat_commodity_order.commodity_id
        LEFT JOIN czb_shop ON czb_shop.shop_id = czb_wechat_commodity.shop_id
        WHERE
        czb_wechat_commodity.is_sale = 1
        AND czb_wechat_commodity.end_time_business &gt;= now()
        <if test = "area != null and area != '' and area != '重庆市'">
            AND area = #{area, jdbcType = VARCHAR}
        </if>
        <if test = "shopPlace != null and shopPlace != '' ">
            AND show_place = #{shopPlace, jdbcType = VARCHAR}
        </if>
        GROUP BY
          commodityId
        ORDER BY
          show_order
    </select>

    <resultMap id="attrsMap" type="com.cqut.czb.bn.entity.dto.WeChatCommodity.WCPCommodityAttrName">
        <result column="commodityId" property="commodityId" jdbcType="VARCHAR" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <collection property="contentList" column="{`name` = name, commodityId = commodityId}" javaType="list" select="selectAttrsByName"/>
    </resultMap>

    <select id="selectAttrsByName" resultType="com.cqut.czb.bn.entity.dto.WeChatCommodity.WCPCommodityAttrContent">
        SELECT
            czb_wechat_commodity_attr.commodity_attr_id commodityAttrId,
            czb_wechat_commodity_attr.attribute_id attributeId,
            czb_wechat_commodity_attr.extra_fy_money extraFyMoney,
            czb_wechat_commodity_attr.commodity_id commodityId,
            czb_attribute.attribute_id attributeId,
            czb_wechat_commodity_attr.extra_sale_money extraSaleMoney,
            czb_file.save_path savePath,
            czb_attribute.`name` `name`,
            czb_attribute.content content
        FROM
            czb_wechat_commodity_attr
            LEFT JOIN czb_attribute ON czb_wechat_commodity_attr.attribute_id = czb_attribute.attribute_id
            LEFT JOIN czb_file ON czb_wechat_commodity_attr.file_id = czb_file.file_id
        WHERE
            czb_wechat_commodity_attr.commodity_id = #{commodityId, jdbcType = VARCHAR}
            AND czb_attribute.`name` = #{`name`, jdbcType = VARCHAR}
        order by
            czb_wechat_commodity_attr.attr_order
    </select>

    <select id="selectCommodityAttrs" parameterType="java.lang.String" resultMap="attrsMap">
        SELECT DISTINCT
            czb_attribute.`name` `name`,
            czb_wechat_commodity_attr.commodity_id commodityId
        FROM
            czb_wechat_commodity_attr
            LEFT JOIN czb_attribute ON czb_wechat_commodity_attr.attribute_id = czb_attribute.attribute_id
        WHERE
            czb_wechat_commodity_attr.commodity_id = #{commodityId, jdbcType = VARCHAR}
    </select>

    <select id="selectPosterImgCount" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM  czb_file_function
        WHERE local_id = #{commodityImgId, jdbcType = VARCHAR}
        AND group_code = 'PosterImg'
    </select>

    <update id="updatePoster">
        UPDATE czb_file_function,
        czb_file
        SET czb_file.save_path = #{address, jdbcType =  VARCHAR}
        WHERE
            czb_file_function.file_id = czb_file.file_id
            AND czb_file_function.local_id = #{commodityImgId, jdbcType =  VARCHAR}
            AND group_code = 'PosterImg'
    </update>

    <select id="selectCommodityImgList" resultType="java.lang.String">
      SELECT
	    save_path
      FROM
        czb_file_function
      LEFT JOIN czb_file on czb_file_function.file_id = czb_file.file_id
      WHERE
		czb_file_function.local_id = #{commodityImgId, jdbcType = VARCHAR}
		AND group_code = 'WCCommodity'
      ORDER BY czb_file_function.create_at
    </select>

    <select id="selectCommodityPosterImg" resultType="java.lang.String">
      SELECT
	    save_path
      FROM
        czb_file_function
      LEFT JOIN czb_file on czb_file_function.file_id = czb_file.file_id
      WHERE
		czb_file_function.local_id = #{commodityImgId, jdbcType = VARCHAR}
		AND group_code = 'PosterImg'
      ORDER BY czb_file_function.create_at
    </select>

    <select id="selectCommodityById" parameterType="java.lang.String" resultMap="WCPCommodityInfoType">
        SELECT
        czb_wechat_commodity.commodity_id commodityId,
        commodity_title commodityTitle,
        commodity_info commodityInfo,
        original_price originalPrice,
        sale_price salePrice,
        take_way takeWay,
        commodity_img_id commodityImgId,
        czb_shop.shop_name shopName,
        czb_shop.shop_content shopContent,
        czb_shop.shop_address shopAddress,
        czb_wechat_commodity.commodity_num commodityNum,
        czb_shop.longitude,
        czb_shop.latitude,
        is_have_shop isHaveShop,
        czb_shop.shop_phone shopPhone,
        czb_wechat_commodity.fy_money totalFyMoney,
        czb_wechat_commodity.starting_time_business startingTimeBusiness,
        czb_wechat_commodity.end_time_business endTimeBusiness,
        czb_wechat_commodity.commodity_introduce commodityIntroduce,
        czb_wechat_commodity.sales_volume salesVolume
        FROM
        czb_wechat_commodity czb_wechat_commodity
        LEFT JOIN czb_wechat_commodity_order ON czb_wechat_commodity.commodity_id = czb_wechat_commodity_order.commodity_id
        LEFT JOIN czb_shop ON czb_shop.shop_id = czb_wechat_commodity.shop_id
        WHERE
        czb_wechat_commodity.is_sale = 1
        AND czb_wechat_commodity.end_time_business &gt;= now()
        AND czb_wechat_commodity.commodity_id = #{commodityId, jdbcType = VARCHAR}
        GROUP BY
        commodityId
        ORDER BY
        show_order
    </select>

    <insert id="insertCommodity" parameterType="com.cqut.czb.bn.entity.dto.wechatAppletCommodity.WxCommodityDTO">
        insert into czb_wechat_commodity
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="commodityId != null" >
                commodity_id,
            </if>
            <if test="shopId != null" >
                shop_id,
            </if>
            <if test="commodityTitle != null" >
                commodity_title,
            </if>
            <if test="commodityInfo != null" >
                commodity_info,
            </if>
            <if test="discount != null" >
                discount,
            </if>
            <if test="commodityImgId != null" >
                commodity_img_id,
            </if>
            <if test="costPrice != null" >
                cost_price,
            </if>
            <if test="originalPrice != null" >
                original_price,
            </if>
            <if test="salePrice != null" >
                sale_price,
            </if>
            <if test="commmodityTypeId != null" >
                commmodity_type_id,
            </if>
            <if test="startingTimeBusiness != null" >
                starting_time_business,
            </if>
            <if test="endTimeBusiness != null" >
                end_time_business,
            </if>
            <if test="commoditySource != null" >
                commodity_source,
            </if>
            <if test="commodityNum != null" >
                commodity_num,
            </if>
            <if test="isSale != null" >
                is_sale,
            </if>
            <if test="takeWay != null" >
                take_way,
            </if>
            <if test="shopName != null" >
                shop_name,
            </if>
            <if test="shopPhone != null" >
                shop_phone,
            </if>
            <if test="shopContent != null" >
                shop_content,
            </if>
            <if test="shopAddress != null" >
                shop_address,
            </if>
            <if test="longitude != null" >
                longitude,
            </if>
            <if test="latitude != null" >
                latitude,
            </if>
            <if test="isHaveShop != null" >
                is_have_shop,
            </if>
            <if test="showPlace != null" >
                show_place,
            </if>
            <if test="showOrder != null" >
                show_order,
            </if>
            <if test="createAt != null" >
                create_at,
            </if>
            <if test="updateAt != null" >
                update_at,
            </if>
            <if test="fyMoney != null" >
                fy_money,
            </if>
            <if test="commodityIntroduce != null" >
                commodity_introduce,
            </if>
            <if test="area != null" >
                area,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="commodityId != null" >
                #{commodityId,jdbcType=VARCHAR},
            </if>
            <if test="shopId != null" >
                #{shopId,jdbcType=VARCHAR},
            </if>
            <if test="commodityTitle != null" >
                #{commodityTitle,jdbcType=VARCHAR},
            </if>
            <if test="commodityInfo != null" >
                #{commodityInfo,jdbcType=VARCHAR},
            </if>
            <if test="discount != null" >
                #{discount,jdbcType=DOUBLE},
            </if>
            <if test="commodityImgId != null" >
                #{commodityImgId,jdbcType=VARCHAR},
            </if>
            <if test="costPrice != null" >
                #{costPrice,jdbcType=DOUBLE},
            </if>
            <if test="originalPrice != null" >
                #{originalPrice,jdbcType=DOUBLE},
            </if>
            <if test="salePrice != null" >
                #{salePrice,jdbcType=DOUBLE},
            </if>
            <if test="commmodityTypeId != null" >
                #{commmodityTypeId,jdbcType=VARCHAR},
            </if>
            <if test="startingTimeBusiness != null" >
                #{startingTimeBusiness,jdbcType=TIMESTAMP},
            </if>
            <if test="endTimeBusiness != null" >
                #{endTimeBusiness,jdbcType=TIMESTAMP},
            </if>
            <if test="commoditySource != null" >
                #{commoditySource,jdbcType=VARCHAR},
            </if>
            <if test="commodityNum != null" >
                #{commodityNum,jdbcType=INTEGER},
            </if>
            <if test="isSale != null" >
                #{isSale,jdbcType=INTEGER},
            </if>
            <if test="takeWay != null" >
                #{takeWay,jdbcType=INTEGER},
            </if>
            <if test="shopName != null" >
                #{shopName,jdbcType=VARCHAR},
            </if>
            <if test="shopPhone != null" >
                #{shopPhone,jdbcType=VARCHAR},
            </if>
            <if test="shopContent != null" >
                #{shopContent,jdbcType=VARCHAR},
            </if>
            <if test="shopAddress != null" >
                #{shopAddress,jdbcType=VARCHAR},
            </if>
            <if test="longitude != null" >
                #{longitude,jdbcType=DOUBLE},
            </if>
            <if test="latitude != null" >
                #{latitude,jdbcType=DOUBLE},
            </if>
            <if test="isHaveShop != null" >
                #{isHaveShop,jdbcType=INTEGER},
            </if>
            <if test="showPlace != null" >
                #{showPlace,jdbcType=VARCHAR},
            </if>
            <if test="showOrder != null" >
                #{showOrder,jdbcType=INTEGER},
            </if>
            <if test="createAt != null" >
                #{createAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updateAt != null" >
                #{updateAt,jdbcType=TIMESTAMP},
            </if>
            <if test="fyMoney != null" >
                #{fyMoney,jdbcType=VARCHAR},
            </if>
            <if test="commodityIntroduce != null" >
                #{commodityIntroduce,jdbcType=VARCHAR},
            </if>
            <if test="area != null" >
                #{area,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>

<!--    获取商品属性的id-->
    <select id="getAttributeId" parameterType="com.cqut.czb.bn.entity.dto.wechatAppletCommodity.WxAttributeDTO" resultType="java.lang.String">
        SELECT
            attribute_id
        FROM
            czb_attribute
        WHERE
            content = #{content};
    </select>
<!-- 新增商品属性信息-->
    <insert id="insertAttrbute" parameterType="com.cqut.czb.bn.entity.dto.wechatAppletCommodity.WxAttributeDTO">
        insert into czb_wechat_commodity_attr
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="commmodityAttrId != null" >
                commodity_attr_id,
            </if>
            <if test="extraFyMoney != null" >
                extra_fy_money,
            </if>
            <if test="commodityId != null" >
                commodity_id,
            </if>
            <if test="attributeId != null" >
                attribute_id,
            </if>
            <if test="extraSaleMoney != null" >
                extra_sale_money,
            </if>
            <if test="fileId != null" >
                file_id,
            </if>
            <if test="attrOrder != null" >
                attr_order,
            </if>
            <if test="createAt != null" >
                create_at,
            </if>
            <if test="updateAt != null" >
                update_at,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="commmodityAttrId != null" >
                #{commmodityAttrId,jdbcType=VARCHAR},
            </if>
            <if test="extraFyMoney != null" >
                #{extraFyMoney,jdbcType=DOUBLE},
            </if>
            <if test="commodityId != null" >
                #{commodityId,jdbcType=VARCHAR},
            </if>
            <if test="attributeId != null" >
                #{attributeId,jdbcType=INTEGER},
            </if>
            <if test="extraSaleMoney != null" >
                #{extraSaleMoney,jdbcType=DOUBLE},
            </if>
            <if test="fileId != null" >
                #{fileId,jdbcType=VARCHAR},
            </if>
            <if test="attrOrder != null" >
                #{attrOrder,jdbcType=INTEGER},
            </if>
            <if test="createAt != null" >
                #{createAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updateAt != null" >
                #{updateAt,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>

    <update id="updateCommodity" parameterType="com.cqut.czb.bn.entity.dto.wechatAppletCommodity.WxCommodityDTO">
        update czb_wechat_commodity
        <set >
            <if test="shopId != null" >
                shop_id = #{shopId,jdbcType=VARCHAR},
            </if>
            <if test="commodityTitle != null" >
                commodity_title = #{commodityTitle,jdbcType=VARCHAR},
            </if>
            <if test="commodityInfo != null" >
                commodity_info = #{commodityInfo,jdbcType=VARCHAR},
            </if>
            <if test="discount != null" >
                discount = #{discount,jdbcType=DOUBLE},
            </if>
            <if test="commodityImgId != null" >
                commodity_img_id = #{commodityImgId,jdbcType=VARCHAR},
            </if>
            <if test="costPrice != null" >
                cost_price = #{costPrice,jdbcType=DOUBLE},
            </if>
            <if test="originalPrice != null" >
                original_price = #{originalPrice,jdbcType=DOUBLE},
            </if>
            <if test="salePrice != null" >
                sale_price = #{salePrice,jdbcType=DOUBLE},
            </if>
            <if test="commmodityTypeId != null" >
                commmodity_type_id = #{commmodityTypeId,jdbcType=VARCHAR},
            </if>
            <if test="startingTimeBusiness != null" >
                starting_time_business = #{startingTimeBusiness,jdbcType=TIMESTAMP},
            </if>
            <if test="endTimeBusiness != null" >
                end_time_business = #{endTimeBusiness,jdbcType=TIMESTAMP},
            </if>
            <if test="commoditySource != null" >
                commodity_source = #{commoditySource,jdbcType=VARCHAR},
            </if>
            <if test="commodityNum != null" >
                commodity_num = #{commodityNum,jdbcType=INTEGER},
            </if>
            <if test="isSale != null" >
                is_sale = #{isSale,jdbcType=INTEGER},
            </if>
            <if test="takeWay != null" >
                take_way = #{takeWay,jdbcType=INTEGER},
            </if>
            <if test="shopName != null" >
                shop_name = #{shopName,jdbcType=VARCHAR},
            </if>
            <if test="shopPhone != null" >
                shop_phone = #{shopPhone,jdbcType=VARCHAR},
            </if>
            <if test="shopContent != null" >
                shop_content = #{shopContent,jdbcType=VARCHAR},
            </if>
            <if test="shopAddress != null" >
                shop_address = #{shopAddress,jdbcType=VARCHAR},
            </if>
            <if test="longitude != null" >
                longitude = #{longitude,jdbcType=DOUBLE},
            </if>
            <if test="latitude != null" >
                latitude = #{latitude,jdbcType=DOUBLE},
            </if>
            <if test="isHaveShop != null" >
                is_have_shop = #{isHaveShop,jdbcType=INTEGER},
            </if>
            <if test="showPlace != null" >
                show_place = #{showPlace,jdbcType=VARCHAR},
            </if>
            <if test="showOrder != null" >
                show_order = #{showOrder,jdbcType=INTEGER},
            </if>
            <if test="createAt != null" >
                create_at = #{createAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updateAt != null" >
                update_at = #{updateAt,jdbcType=TIMESTAMP},
            </if>
            <if test="fyMoney != null" >
                fy_money = #{fyMoney,jdbcType=VARCHAR},
            </if>
            <if test="commodityIntroduce != null" >
                commodity_introduce = #{commodityIntroduce,jdbcType=VARCHAR},
            </if>
            <if test="area != null" >
                area = #{area,jdbcType=VARCHAR},
            </if>
            <if test="salesVolume != null" >
                sales_volume = #{salesVolume,jdbcType=INTEGER},
            </if>
        </set>
        where commodity_id = #{commodityId,jdbcType=VARCHAR}
    </update>

    <update id="updateIsSale">
        update czb_wechat_commodity
        SET is_sale = #{isSale, jdbcType = INTEGER}
        WHERE czb_wechat_commodity.commodity_id in (${ids})
    </update>

    <select id="getAttributeName" resultType="java.lang.String">
        SELECT name
        FROM  czb_attribute
        GROUP BY name;
    </select>

    <select id="getAttributeContent" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT content
        FROM `czb_attribute`
        WHERE name =#{name}
        GROUP BY content;
    </select>

<!--    编辑商品属性信息-->
    <update id="updateWxAttribute">
        UPDATE czb_wechat_commodity_attr
	    SET extra_fy_money = #{extraFyMoney, jdbcType = VARCHAR},
		extra_sale_money = #{extraSaleMoney},
		update_at = #{updateAt},
		attribute_id = #{attributeId}
	WHERE commodity_attr_id = #{commmodityAttrId};
    </update>

    <update id="updaFile">
        UPDATE czb_file
        SET file_name = #{fileName, jdbcType = VARCHAR},
            save_path = #{address},
            update_at = #{date}
        WHERE
            file_id  IN ( SELECT file_id FROM czb_file_function WHERE local_id = #{id});
    </update>

    <select id="checkWxAttribute" resultMap="BaseAttributeMap">
        SELECT
            czb_wechat_commodity_attr.commodity_attr_id,
            czb_wechat_commodity_attr.extra_fy_money,
            czb_wechat_commodity_attr.commodity_id,
            czb_wechat_commodity_attr.attribute_id,
            czb_wechat_commodity_attr.extra_sale_money,
            czb_wechat_commodity_attr.file_id,
            czb_wechat_commodity_attr.attr_order,
            czb_attribute.`name`,
            czb_attribute.content
        FROM
            czb_wechat_commodity_attr,
            czb_attribute
        WHERE
            czb_wechat_commodity_attr.commodity_id = #{commodityId}
            <if test = "content != null">
                AND czb_attribute.content = #{content}
            </if>
            <if test = "name != null">
                AND  czb_attribute.`name` = #{name}
            </if>
            AND czb_wechat_commodity_attr.attribute_id IN (
            SELECT attribute_id FROM czb_attribute
            WHERE
            <if test = "name != null">
                `name` = #{name}
            </if>
            <if test = "name != null and content != null">
                and
            </if>
            <if test = "content != null">
                content = #{content}
            </if>
            )

    </select>
</mapper>