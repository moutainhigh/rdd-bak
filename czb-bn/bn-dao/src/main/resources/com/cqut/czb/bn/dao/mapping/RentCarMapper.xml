<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org// DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cqut.czb.bn.dao.mapper.RentCarMapper">
    <resultMap id="BaseResultMap" type="com.cqut.czb.bn.entity.dto.rentCar.personIncome">
        <result column="fanyong_income" jdbcType="DOUBLE" property="fanYongIncome"></result>
        <result column="share_income" jdbcType="DOUBLE" property="shareIncome"></result>
        <result column="got_total_rent" jdbcType="DOUBLE" property="rentIncome"></result>
        <result column="other_income" jdbcType="DOUBLE" property="otherIncome"></result>
        <result column="withdrawed" jdbcType="DOUBLE" property="withDrawed"></result>
    </resultMap>

    <select id="getPersonIncome" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
        fanyong_income,
        share_income,
        got_total_rent,
        other_income,
        withdrawed
        FROM czb_user_income_info
        WHERE user_id = #{userId}
    </select>

    <select id="getOneContractInfo" parameterType="java.lang.String" resultType="com.cqut.czb.bn.entity.dto.rentCar.OneContractInfoDTO">
        SELECT
        cp.car_license AS carLicense,
        cp.identify_code AS identifyCode,
        c.startTime AS startTime,
        c.endTime AS endTime,
        c.State AS status,
        c.num AS contractId,
        c.rent AS rentMoney
        FROM
            czb_cars_persons cp,
            (
                SELECT
                    record_id,
                    third_contract_num num,
                    date_format(contract_start_time, '%Y.%m.%d') startTime,
			        date_format(contract_end_time, '%Y.%m.%d') endTime,
                    contract_state State,
                    rent
                FROM
                    czb_contract_records cc
                WHERE
                    cc.user_id = #{userId}
            ) AS c
        WHERE
        cp.contract_record_id = #{contractId} and c.record_id = #{contractId}
    </select>

    <select id="getPersonalContractList" resultType="com.cqut.czb.bn.entity.dto.rentCar.PersonalContractDTO">
        SELECT
        cp.car_license AS carLicense,
        c.endTime AS endTime,
        c.State AS status,
        c.num AS contractId
        FROM
            czb_cars_persons cp,
            (
                SELECT
                    record_id,
                    third_contract_num num,
                    date_format(contract_start_time, '%Y.%m.%d') startTime,
			        date_format(contract_end_time, '%Y.%m.%d') endTime,
                    contract_state State,
                    rent
                FROM
                    czb_contract_records cc
                WHERE
                    cc.user_id = #{userId}
            ) AS c
        WHERE
        cp.contract_record_id = c.record_id
    </select>

</mapper>