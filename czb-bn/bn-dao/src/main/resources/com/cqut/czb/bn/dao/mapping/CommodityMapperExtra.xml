<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cqut.czb.bn.dao.mapper.CommodityMapperExtra">

    <select id="selectCommoditys" resultType="com.cqut.czb.bn.entity.dto.Commodity.CommodityDTO" parameterType="java.lang.String">
        select
        commodity_id as commodityId, shop_id as shopId, commodity_title as commodityTitle, commodity_info as commodityInfo,
        discount as discount, save_path as commodityImg,commodity_price as commodityPrice, classification as classification,
        usage_count as usageCount, czb_commodity.create_at as createAt, czb_commodity.update_at as updateAt
        from czb_commodity,czb_file
        <where>
            <if test="classification!=null and classification!=''">
                classification=#{classification,jdbcType=VARCHAR}
            </if>
            and commodity_img=file_id
        </where>
    </select>

    <select id="selectServiceDetails" resultType="com.cqut.czb.bn.entity.dto.Commodity.ServiceDetailsDTO" parameterType="java.lang.String">
       select
        commodity_id as commodityId, commodity_title as commodityTitle, commodity_info as commodityInfo,
        discount, commodity_img as commodityImg,
        commodity_price as commodityPrice, classification, usage_count as usageCount,
        shop_address as shopAddress,shop_content as shopContent,shop_name as shopName,
        shop_phone as shopPhone
        from
        czb_commodity,czb_shop
        WHERE
        czb_commodity.shop_id=czb_shop.shop_id
        AND
        commodity_id=#{commodityId,jdbcType=VARCHAR}
  </select>

    <!--级联查询-->
    <resultMap id="selectGoods" type="com.cqut.czb.bn.entity.dto.Commodity.AllCommodityDTO">
        <result property="navName" column="navName"/>
        <collection property="serviceDetailsDTOList" column="navName" javaType="list" select="selectLists"/>
    </resultMap>
    
    <!--get all rooter-->
    <select id="selectAllCommodity" resultMap="selectGoods" parameterType="java.lang.String">
      select distinct classification as navName
      from czb_commodity
      <where>
        <if test="classification!=null and classification!=''">
          classification=#{classification,jdbcType=VARCHAR}
        </if>
      </where>
    </select>

    <!--get the information-->
    <select id="selectLists" resultType="com.cqut.czb.bn.entity.dto.Commodity.ServiceDetailsDTO">
        select commodity_title as commodityTitle, commodity_info as commodityInfo,
        discount, commodity_img as commodityImg,
        commodity_price as commodityPrice, classification, usage_count as usageCount,
        shop_address as shopAddress,shop_content as shopContent,shop_name as shopName,
        shop_phone as shopPhone
        from
        czb_commodity,czb_shop
        WHERE
        czb_commodity.shop_id=czb_shop.shop_id
        AND
        classification=#{navName}
    </select>

    <!--get the nav-->
    <select id="selectShopSettleNav" resultType="com.cqut.czb.bn.entity.dto.Commodity.NavDTO">
        select distinct classification as navName
        from czb_commodity
    </select>
</mapper>