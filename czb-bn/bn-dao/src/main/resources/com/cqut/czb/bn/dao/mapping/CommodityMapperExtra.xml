<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cqut.czb.bn.dao.mapper.CommodityMapperExtra">
    <resultMap id="BaseResultMap" type="com.cqut.czb.bn.entity.entity.Commodity">
        <id column="commodity_id" property="commodityId" jdbcType="VARCHAR"/>
        <result column="shop_id" property="shopId" jdbcType="VARCHAR"/>
        <result column="commodity_title" property="commodityTitle" jdbcType="VARCHAR"/>
        <result column="commodity_info" property="commodityInfo" jdbcType="VARCHAR"/>
        <result column="discount" property="discount" jdbcType="DOUBLE"/>
        <result column="commodity_img" property="commodityImg" jdbcType="VARCHAR"/>
        <result column="commodity_price" property="commodityPrice" jdbcType="DOUBLE"/>
        <result column="classification" property="classification" jdbcType="VARCHAR"/>
        <result column="usage_count" property="usageCount" jdbcType="INTEGER"/>
        <result column="create_at" property="createAt" jdbcType="TIMESTAMP"/>
        <result column="update_at" property="updateAt" jdbcType="TIMESTAMP"/>
    </resultMap>
    <sql id="Base_Column_List">
    commodity_id, shop_id, commodity_title, commodity_info, discount, commodity_img, 
    commodity_price, classification, usage_count, create_at, update_at
  </sql>

    <select id="selectCommoditys" resultMap="BaseResultMap" parameterType="java.lang.String">
        select
        <include refid="Base_Column_List"/>
        from czb_commodity
        where classification = #{classification,jdbcType=VARCHAR}
    </select>

    <select id="selectServiceDetails" resultType="com.cqut.czb.bn.entity.dto.Commodity.ServiceDetailsDTO" parameterType="java.lang.String">
       select
        commodity_title as commodityTitle, commodity_info as commodityInfo,
        discount, commodity_img as commodityImg,
        commodity_price as commodityPrice, classification, usage_count as usageCount,
        shop_address as shopAddress,shop_content as shopContent,shop_name as shopName,
        shop_phone as shopPhone
        from
        czb_commodity,czb_shop
        WHERE
        czb_commodity.shop_id=czb_shop.shop_id
        AND
        commodity_id=#{commodityId,jdbcType=VARCHAR}
  </select>

    <!--级联查询-->
    <resultMap id="selectGoods" type="com.cqut.czb.bn.entity.dto.Commodity.AllCommodityDTO">
        <result property="navName" column="navName"/>
        <collection property="serviceDetailsDTOList" column="navName" javaType="list" select="selectLists"/>
    </resultMap>
    
    <!--get all rooter-->
    <select id="selectAllCommodity" resultMap="selectGoods" parameterType="java.lang.String">
      select distinct classification as navName
      from czb_commodity
      <where>
        <if test="classification!=null and classification!=''">
          classification=#{classification,jdbcType=VARCHAR}
        </if>
      </where>
    </select>

    <!--get the information-->
    <select id="selectLists" resultType="com.cqut.czb.bn.entity.dto.Commodity.ServiceDetailsDTO">
        select commodity_title as commodityTitle, commodity_info as commodityInfo,
        discount, commodity_img as commodityImg,
        commodity_price as commodityPrice, classification, usage_count as usageCount,
        shop_address as shopAddress,shop_content as shopContent,shop_name as shopName,
        shop_phone as shopPhone
        from
        czb_commodity,czb_shop
        WHERE
        czb_commodity.shop_id=czb_shop.shop_id
        AND
        classification=#{navName}
    </select>

</mapper>